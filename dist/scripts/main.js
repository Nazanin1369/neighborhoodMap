"use strict";function getInstaPics(n,e){var t="85a5b3cd341344cebeea9a990a80b3ed";return $.getJSON("https://api.instagram.com/v1/tags/"+e+"/media/recent?callback=?&client_id="+t+"&count="+n)}function filterUniversities(n,e){return _.filter(n,function(n){return n.name().indexOf(e)>-1})}-function(){function n(n,e){var t=n?n[e.full]||n[e.parent]||n[e.name]||{}:{};return l&&l(e,t,n),t}function e(n){return null===n||void 0===n}function t(n){return null===n||void 0===n||n.constructor===String||n.constructor===Number||n.constructor===Boolean||n instanceof Date}function o(r,a,l,c){var u,p,g,_,v,h,y;if(c=c||n(a,l),u=c.custom)h=!0,"function"==typeof u?(p=u(r),e(p)||(p.___$mapCustom=u)):(p=u.map(r),e(p)||(p.___$mapCustom=u.map,u.unmap&&(p.___$unmapCustom=u.unmap)));else if(c.append)h=!0,p=r;else{if(c.exclude)return h=!0,d;if(t(r))p=l.parentIsArray?r:f(r);else if(r instanceof Array){for(p=[],g=0,u=r.length;u>g;g++)p[g]=o(r[g],a,{name:"[i]",parent:l.name+"[i]",full:l.full+"[i]",parentIsArray:!0});(!l.parentIsArray||s)&&(_={name:"[i]",parent:l.name+"[i]",full:l.full+"[i]",parentIsArray:!0},p=m(p),(r=c.arrayChildId)&&(p.___$childIdName=r),p.pushFromModel=function(n){n=o(n,a,_),p.push(n)},p.unshiftFromModel=function(n){n=o(n,a,_),p.unshift(n)},p.popToModel=function(n){return n=p.pop(),i(n,_)},p.shiftToModel=function(n){return n=p.shift(),i(n,_)})}else if(r.constructor===Object)for(g in p={},r)_={name:g,parent:("[i]"===l.name?l.parent:l.name)+"."+g,full:l.full+"."+g},y=r[g],(u=t(y)?n(a,_):void 0)&&u.custom?(p.___$customChildren=p.___$customChildren||{},p.___$customChildren[g]=u.custom,p[g]="function"==typeof u.custom?u.custom(r[g]):u.custom.map(r[g])):(u=o(y,a,_,u),u!==d&&(p[g]=u))}return!h&&(v=c.extend)&&("function"==typeof v?p=v(p)||p:v.constructor===Object&&("function"==typeof v.map&&(p=v.map(p)||p),"function"==typeof v.unmap&&(p.___$unmapExtend=v.unmap))),p}function i(n,o){var r,a,s,u,f=c(n);if(u=n!==f,l&&l(o),!u&&n&&n.constructor===Function)return d;if(n&&n.___$unmapCustom)r=n.___$unmapCustom(n);else if(u&&t(f)||e(f))r=f;else if(f instanceof Array)for(r=[],a=0,s=f.length;s>a;a++)r[a]=i(f[a],{name:"[i]",parent:o.name+"[i]",full:o.full+"[i]"});else if(f.constructor===Object)for(a in r={},f)"___$"!==a.substr(0,4)&&(n.___$customChildren&&n.___$customChildren[a]&&n.___$customChildren[a].unmap?r[a]=n.___$customChildren[a].unmap(f[a]):(u=f[a],ko.isComputed(u)||(s=c(u))&&s.constructor===Function||(u=i(u,{name:a,parent:("[i]"===o.name?o.parent:o.name)+"."+a,full:o.full+"."+a}),u!==d&&(r[a]=u))));else!u&&"function"!=typeof f&&(r=f);return n&&n.___$unmapExtend&&(r=n.___$unmapExtend(r,n)),r}function r(n,o,i,a,s){var f,m,p,d,g,_,v,h=c(o);if(m=o!==h,l&&l(i),m&&e(h)^e(n))o(n);else if(n&&h&&h.constructor==Object&&n.constructor===Object)for(f in n)o.___$customChildren&&o.___$customChildren[f]?(a=o.___$customChildren[f].map||o.___$customChildren[f],h[f]=a(n[f])):(a=h[f],!m&&h.hasOwnProperty(f)&&(t(a)||a&&a.constructor===Array)?h[f]=n[f]:a&&"function"==typeof a.___$mapCustom?u(a)?(p=a.___$mapCustom(n[f],a),p=c(p),a(p)):h[f]=a.___$mapCustom(n[f],a):e(n[f])&&h[f]&&h[f].constructor===Object?h[f]=n[f]:s?(a=function(n,e,t){return function(){r(n[t],h[t],{name:t,parent:("[i]"===i.name?i.parent:i.name)+"."+t,full:i.full+"."+t},h,s),s(s()-1)}}(n,o,f),s(s()+1),setTimeout(a,0)):r(n[f],h[f],{name:f,parent:("[i]"===i.name?i.parent:i.name)+"."+f,full:i.full+"."+f}));else if(h&&h instanceof Array)if(v=o.___$childIdName){for(p=[],d=[],f=n.length-1;f>=0;f--)for(g=n[f][v],m=h.length-1;m>=0;m--)if(a=h[m],_=c(a),_=c(_[v]),_===g){a.___$mapCustom?ko.isObservable(a)?(g=a.___$mapCustom(n[f],a),u(g)&&g!=a&&a(c(g))):h[m]=a.___$mapCustom(n[f],a):s?(a=function(n,e,t,o){return function(){r(n[t],h[o],{name:"[i]",parent:i.name+"[i]",full:i.full+"[i]"},void 0,s),s(s()-1)}}(n,o,f,m),s(s()+1),setTimeout(a,0)):r(n[f],h[m],{name:"[i]",parent:i.name+"[i]",full:i.full+"[i]"}),d[m]=!0,p[f]=!0;break}for(m=h.length-1;m>=0;m--)d[m]||o.splice(m,1);for(f=n.length-1;f>=0;f--)p[f]||o.pushFromModel(n[f])}else if(p=[],m=o.___$mapCustom,"function"==typeof m){for(f=0,a=n.length;a>f;f++)p[f]=n[f];o(m(p))}else for(o(p),f=0,a=n?n.length:0;a>f;f++)o.pushFromModel(n[f]);else m&&o(n);return"{root}"===i.name&&s?{onComplete:function(n){n&&"function"==typeof n&&(s?ko.computed(function(){n&&0===s()&&(n(),n=void 0)}).extend({throttle:50}):n())}}:void 0}function a(n,e){s=n.makeChildArraysObservable,window.console&&n.logging?(console.log(e),l=function(n,e,t){console.log("- "+(e&&e.settingType?e.settingType+" "+n.full+" (matched: '"+((t[n.full]?n.full:"")||(t[n.parent]?n.parent:"")||n.name)+"')":"default "+n.full))}):l=void 0}var l,s,c=ko.utils.unwrapObservable,u=ko.isObservable,f=ko.observable,m=ko.observableArray,p={name:"{root}",parent:"{root}",full:"{root}"},d=function(){};ko.viewmodel={options:{makeChildArraysObservable:!0,logging:!1},fromModel:function(n,e){var t,i,r,l,s,c,u,f={},m=e?e.shared||{}:{};for(s in e)if(t=e[s]||{},"shared"!==s)if(t instanceof Array)for(i=0,l=t.length;l>i;i++)r=t[i],f[r]=f[r]||{},f[r][s]=!0,f[r].settingType=f[r].settingType?"multiple":s;else if(t.constructor===Object)for(r in t){if(f[r]=f[r]||{},i=t[r],(i="arrayChildId"!==s&&i&&i.constructor===String&&m[i]?m[i]:i)&&i.constructor===Object)for(c in i)(u=i[c])&&u.constructor==String&&m[u]&&(i[c]=m[u]);f[r][s]=i,f[r].settingType=f[r].settingType?"multiple":s}return a(this.options,"Mapping From Model"),o(n,f,p)},toModel:function(n){return a(this.options,"Mapping To Model"),i(n,p)},updateFromModel:function(n,e,t){return t=t?ko.observable(0):void 0,a(this.options,"Update From Model"),r(e,n,p,void 0,t)}}}();var viewModel={},model={universities:[]};$(function(){googleMapService.initializeMap(),googleMapService.fitBounds(),googleMapService.getData().then(function(n){console.log(n);for(var e=0;e<n.length;e++)n[e].location={lat:n[e].geometry.location.H,"long":n[e].geometry.location.L};getInstaPics(10,"standford").then(function(n){console.log(n.data)}),model.universities=n;var t=ko.viewmodel.fromModel(model,{extend:{"{root}.universities[i]":function(n){n.showInfoWindow=function(){googleMapService.openInfoWindow(n)}},"{root}":function(n){n.searchText=ko.observable("")}}});console.log("vm: ",t),viewModel=t,t.searchText.subscribe(function(n){console.log(n);var e=filterUniversities(viewModel.universities(),n),o={universities:function(){return e}};console.log(o),ko.viewmodel.updateFromModel(t,o,!0).onComplete(function(){console.log(ko.viewmodel.toModel(o))}),viewModel=o});for(var e=0;e<viewModel.universities().length;e++)googleMapService.createMarker(viewModel.universities()[e]);ko.applyBindings(viewModel),googleMapService.initializeInfoWindow()})["catch"](function(n){console.log(n)})});var googleMapService=new function(){var n,e,t,o=this,i=[];o.getMap=function(){return n},o.getInfoWindow=function(){return e},o.getMarkers=function(){return i},o.clearMarkers=function(){i.forEach(function(n){n&&n.setMap(null)}),i=[]},o.createMarker=function(t){var i=new google.maps.Marker({position:new google.maps.LatLng(t.location.lat(),t.location["long"]()),animation:google.maps.Animation.DROP,icon:"../images/uni.png"});return i.setMap(n),google.maps.event.addListener(i,"click",function(){o.bounceOnce(this),e.setContent(o.createInfoWindowContent(t)),e.open(n,this)}),i},o.openInfoWindow=function(t){var i=new google.maps.Marker({position:new google.maps.LatLng(t.location.lat(),t.location["long"]()),animation:google.maps.Animation.DROP,icon:"../images/uni.png"});return i.setMap(n),o.bounceOnce(i),e.setContent(o.createInfoWindowContent(t)),e.open(n,i),i},o.fitBounds=function(){var e=new google.maps.LatLngBounds;if(i.length>0){for(var t=0;t<i.length;t++)i[t].getVisible()&&e.extend(i[t].getPosition());n.fitBounds(e)}},o.bounceOnce=function(n){n.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.setAnimation(null)},1400)},o.selectMarker=function(n,e){t=e,google.maps.event.trigger(i[n],"click")},o.initializeMap=function(e){var t=new google.maps.LatLng(37.6292,-122.1381),o={center:t,zoom:10,disableDefaultUI:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};n=new google.maps.Map(document.getElementById("google-map"),o)},o.getData=function(){var e={location:{lat:37.4292,lng:-122.1381},radius:4e4,types:["university"]};return new Promise(function(t,o){function i(n,e){e===google.maps.places.PlacesServiceStatus.OK&&t(n),o(e)}new google.maps.places.PlacesService(n).nearbySearch(e,i)})},o.initializeInfoWindow=function(){e=new google.maps.InfoWindow,google.maps.event.addListener(e,"domready",function(){var n=$(".gm-style-iw"),e=n.prev();e.children(":nth-child(2)").css({display:"none"}),e.children(":nth-child(4)").css({display:"none"}),e.children(":nth-child(1)").attr("style",function(n,e){return e+"left: 76px !important;"}),e.children(":nth-child(3)").attr("style",function(n,e){return e+"left: 76px !important;"}),e.children(":nth-child(3)").find("div").children().css({"box-shadow":"rgba(72, 181, 233, 0.6) 0px 1px 6px","z-index":"1"}),e.children(":nth-child(3)").attr("style",function(n,e){return e+"margin: 0px; padding: 0px;"});var t=n.next();t.css({display:"none"})})},o.createInfoWindowContent=function(n){var e,t='<div class="info-card-wide mdl-card mdl-shadow--2dp">\n                        <div class="mdl-card__title">\n                            <h2 class="mdl-card__title-text">@@name@@</h2>\n                        </div>\n                        <div class="mdl-card__supporting-text">\n                          <strong>Rating: @@uniRating@@</strong>\n                          <br/>\n                          <span>@@uniVicinity@@</span>\n                          <br/>\n                          <span class="pull-right">\n                              <img src="../images/insta.png" class="insta-icon"/>\n                          </span>\n                        </div>\n                        <div class="mdl-card__menu">\n                          <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" onclick="googleMapService.getInfoWindow().close()">\n                            <i class="material-icons">clear</i>\n                          </button>\n                        </div></div>';return e="undefined"==typeof n.rating?"no rating":n.rating(),t=t.replace("@@name@@",n.name()),t=t.replace("@@uniRating@@",e),t=t.replace("@@uniVicinity@@",n.vicinity())}};